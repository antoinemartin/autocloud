
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../3-change-encryption-key/">
      
      
        <link rel="next" href="../5-cluster-deployment/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.5">
    
    
      
        <title>4. Adapt the environment - Autocloud: GitOps Kubernetes Bootstrapper</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#environment-adaptation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Autocloud: GitOps Kubernetes Bootstrapper" class="md-header__button md-logo" aria-label="Autocloud: GitOps Kubernetes Bootstrapper" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Autocloud: GitOps Kubernetes Bootstrapper
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              4. Adapt the environment
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/antoinemartin/autocloud" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    antoinemartin/autocloud
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Autocloud: GitOps Kubernetes Bootstrapper" class="md-nav__button md-logo" aria-label="Autocloud: GitOps Kubernetes Bootstrapper" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Autocloud: GitOps Kubernetes Bootstrapper
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/antoinemartin/autocloud" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    antoinemartin/autocloud
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="true">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1-pre-requisites/" class="md-nav__link">
        1. Pre-requisites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2-gitops-setup/" class="md-nav__link">
        2. Gitops setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../3-change-encryption-key/" class="md-nav__link">
        3. Change the encryption key
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          4. Adapt the environment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        4. Adapt the environment
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adapt-secrets-and-properties" class="md-nav__link">
    Adapt secrets and properties
  </a>
  
    <nav class="md-nav" aria-label="Adapt secrets and properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster-identifier-and-domain-name" class="md-nav__link">
    Cluster identifier and domain name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets-encryption-key" class="md-nav__link">
    Secrets encryption key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repositiory-access" class="md-nav__link">
    Repositiory access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argo-cd-authentication" class="md-nav__link">
    Argo CD Authentication
  </a>
  
    <nav class="md-nav" aria-label="Argo CD Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-admin-password" class="md-nav__link">
    Local admin password
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#github-oidc-authentication" class="md-nav__link">
    Github OIDC authentication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argo-cd-webhook-update" class="md-nav__link">
    Argo CD Webhook update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-provider-api-credentials" class="md-nav__link">
    DNS provider API credentials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#online-presence" class="md-nav__link">
    Online presence
  </a>
  
    <nav class="md-nav" aria-label="Online presence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloudflare-tunnel" class="md-nav__link">
    Cloudflare tunnel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sish" class="md-nav__link">
    Sish
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-properties" class="md-nav__link">
    Other properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#committing-current-configuration" class="md-nav__link">
    Committing current configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-properties-to-kustomizations-and-applications" class="md-nav__link">
    Applying properties to kustomizations and applications
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#selecting-the-applications-to-deploy-at-bootstrap" class="md-nav__link">
    Selecting the applications to deploy at bootstrap
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../5-cluster-deployment/" class="md-nav__link">
        5. Deploy the cluster
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="false">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/secrets/" class="md-nav__link">
        Secrets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/properties/" class="md-nav__link">
        Properties
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" tabindex="0" aria-expanded="false">
          Components
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Components" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Components
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../components/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../components/argo-cd/" class="md-nav__link">
        Argo CD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../components/sops/" class="md-nav__link">
        SOPS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../components/sish/" class="md-nav__link">
        SISH
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" tabindex="0" aria-expanded="false">
          Howtos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Howtos" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Howtos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../howtos/k3s-windows-install/" class="md-nav__link">
        Install K3s on Windows
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adapt-secrets-and-properties" class="md-nav__link">
    Adapt secrets and properties
  </a>
  
    <nav class="md-nav" aria-label="Adapt secrets and properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster-identifier-and-domain-name" class="md-nav__link">
    Cluster identifier and domain name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets-encryption-key" class="md-nav__link">
    Secrets encryption key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repositiory-access" class="md-nav__link">
    Repositiory access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argo-cd-authentication" class="md-nav__link">
    Argo CD Authentication
  </a>
  
    <nav class="md-nav" aria-label="Argo CD Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-admin-password" class="md-nav__link">
    Local admin password
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#github-oidc-authentication" class="md-nav__link">
    Github OIDC authentication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argo-cd-webhook-update" class="md-nav__link">
    Argo CD Webhook update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-provider-api-credentials" class="md-nav__link">
    DNS provider API credentials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#online-presence" class="md-nav__link">
    Online presence
  </a>
  
    <nav class="md-nav" aria-label="Online presence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloudflare-tunnel" class="md-nav__link">
    Cloudflare tunnel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sish" class="md-nav__link">
    Sish
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-properties" class="md-nav__link">
    Other properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#committing-current-configuration" class="md-nav__link">
    Committing current configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-properties-to-kustomizations-and-applications" class="md-nav__link">
    Applying properties to kustomizations and applications
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#selecting-the-applications-to-deploy-at-bootstrap" class="md-nav__link">
    Selecting the applications to deploy at bootstrap
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/antoinemartin/autocloud/edit/main/docs/getting-started/4-environment-adaptation.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/antoinemartin/autocloud/raw/main/docs/getting-started/4-environment-adaptation.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  



<h1 id="environment-adaptation">Environment adaptation<a class="headerlink" href="#environment-adaptation" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Adapting the environment involves the following tasks:</p>
<ul>
<li>Adapt the secrets file <code>secrets/secrets.yaml</code> and the properties file
    <code>values.yaml</code> to the target environment.</li>
<li>Apply the defined properties to the applications and kustomizations. That
    means make the structural replacements in the resources for the defined
    properties.</li>
<li>Select the applications to be deployed in the target environment.</li>
</ul>
<p>The secrets are in <code>secrets/secrets.yaml</code> and the properties in <code>values.yaml</code>.
They live in separate files for several reasons:</p>
<ul>
<li>The secrets are encrypted using sops whereas the properties are kept in
    plain text.</li>
<li>The properties are applied <strong>before</strong> committing. Secrets are opaque so
    having any value in the files is not that important. To the contrary, having
    actual values for other properties allows browsing of the repo without the
    need to always refer to the centralized <code>values.yaml</code>. Therefore, the
    applications and kustomizations contain the actual property values.
    <em>Applying</em> from a centralized file is just a convenience to ease adaptation
    and avoid oversights (see the
    <a href="/user-guide/properties">properties documentation</a>).</li>
<li>The kustomizations contain plain text <strong>fake</strong> secrets. They are
    <strong>replaced</strong> with actual values <strong>in the cluster</strong> while the kustomizations
    are built. Unencrypted values are injected in the kustomization by
    <code>krmfnbuiltin</code> (more information in the <a href="/user-guide/secrets">user guide</a>).</li>
</ul>
<h2 id="adapt-secrets-and-properties">Adapt secrets and properties<a class="headerlink" href="#adapt-secrets-and-properties" title="Permanent link">&para;</a></h2>
<p>First you need an unencrypted secrets file. If you are comming from
<a href="../3-change-encryption-key"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg></span>the previous step</a> this is
already the case. If not, issue the following command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Shell</label><label for="__tabbed_1_2">PowerShell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>$<span class="w"> </span>sops<span class="w"> </span>-d<span class="w"> </span>secrets/secrets.yaml<span class="w"> </span>&gt;<span class="w"> </span>secrets/secrets.dec.yaml
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>$
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="p">...</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="n">sops</span> <span class="n">-d</span> <span class="n">secrets</span><span class="p">/</span><span class="n">secrets</span><span class="p">.</span><span class="n">yaml</span> <span class="p">&gt;</span> <span class="n">secrets</span><span class="p">/</span><span class="n">secrets</span><span class="p">.</span><span class="n">dec</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">PS</span><span class="p">&gt;</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="cluster-identifier-and-domain-name">Cluster identifier and domain name<a class="headerlink" href="#cluster-identifier-and-domain-name" title="Permanent link">&para;</a></h3>
<p>The first properties of the <code>values.yaml</code> file contain global information about
the cluster:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">klasmikloud</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">        </span><span class="nt">dnsZone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">klasmik.com</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">        </span><span class="nt">argocd</span><span class="p">:</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">            </span><span class="nt">domainPrefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">argocd-devenv</span>
</code></pre></div>
<p><code>id</code> is the identifier of the cluster. <code>dnsZone</code> is the global domain name used
by the cluster. <code>argocd.domainPrefix</code> allows the composition of the Argo CD UI
domain name. In our example, it will be <code>argocd-devenv.klasmik.com</code>.</p>
<h3 id="secrets-encryption-key">Secrets encryption key<a class="headerlink" href="#secrets-encryption-key" title="Permanent link">&para;</a></h3>
<p>Argo CD, When building kustomizations, need to have access to a decryption key
to be able to decrypt the <code>secrets/secrets.yaml</code> file in order to inject
secrets. This key is the key that you have created in
<a href="../3-change-encryption-key/">the previous step</a> and that is located in
<code>~/.config/sops/age/keys.txt</code> (or <code>$env:APPDATA\sops\age\keys.txt</code> on Windows)</p>
<p>Put this key under <code>data.sops.age_key\.txt</code> in <code>secrets/secrets.dec.yaml</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># secrets/secrets.dec.yaml</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="c1">#...</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="nt">sops</span><span class="p">:</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">        </span><span class="nt">age_key.txt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">            </span><span class="no"># created: 2023-01-19T19:41:45Z</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">            </span><span class="no"># public key: age166k86d56ejs2ydvaxv2x3vl3wajny6l52dlkncf2k58vztnlecjs0g5jqq</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">            </span><span class="no">AGE-SECRET-KEY-15RKTPQCCLWM7EHQ8JEP0TQLUWJAECVP7332M3ZP0RL9R7JT7MZ6SY79V8Q</span>
</code></pre></div>
<h3 id="repositiory-access">Repositiory access<a class="headerlink" href="#repositiory-access" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Optional</p>
<p>This is only needed if your repository is private.</p>
</div>
<p>To allow Argo CD to access the private repository, you can either use a <a href="https://docs.github.com/en/developers/overview/managing-deploy-keys#deploy-keys)" rel="noopener" target="_blank">deploy
key</a> or a <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token" rel="noopener" target="_blank">Personal Access Token</a>. The later is only
interesting for accessing several repositories with the same credentials but is
weaker in terms of security. For the initial setup, reading access to the
autocloud repo is the only thing that we need. So for now, we will move forward
with a deploy key.</p>
<p>Create a SSH key with the following command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Shell</label><label for="__tabbed_2_2">PowerShell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>$<span class="w"> </span>ssh-keygen<span class="w"> </span>-N<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>-C<span class="w"> </span>autocloud<span class="w"> </span>-q<span class="w"> </span>-t<span class="w"> </span>ed25519<span class="w"> </span>-f<span class="w"> </span>autocloud
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>$<span class="w"> </span>cat<span class="w"> </span>autocloud.pub
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>ssh-ed25519<span class="w"> </span>AAAAC3NzaC1lZDI1NTE5AAAAIOqETmwadG+AtnC3HvdT66SIcilJIZdaRIrSRETHK1fU<span class="w"> </span>autocloud
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>$
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="c"># Note the backquotes before the double quotes</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="n">ssh-keygen</span><span class="p">.</span><span class="n">exe</span> <span class="n">-q</span> <span class="n">-C</span> <span class="n">autocloud</span> <span class="n">-t</span> <span class="n">ed25519</span> <span class="n">-N</span> <span class="p">`&quot;`&quot;</span> <span class="o">-f</span> <span class="n">autocloud</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="nb">type </span><span class="n">autocloud</span><span class="p">.</span><span class="n">pub</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">ssh-ed25519</span> <span class="n">AAAAC3NzaC1lZDI1NTE5AAAAIOqETmwadG</span><span class="p">+</span><span class="n">AtnC3HvdT66SIcilJIZdaRIrSRETHK1fU</span> <span class="n">autocloud</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="n">PS</span><span class="p">&gt;</span>
</code></pre></div>
</div>
</div>
</div>
<p>And then add it to the repo with the github CLI:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="go">&gt;  gh repo deploy-key add autocloud.pub --title autocloud</span>
</code></pre></div>
<p>You can also do it on github.com. Go to the following URL:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># In our case, https://github.com/klasmik/klasmikloud/settings/keys/new</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>https://github.com/&lt;organization&gt;/&lt;project&gt;/settings/keys/new
</code></pre></div>
<p>And enter the public key:</p>
<p><img alt="add deploy key" src="../../img/add_deploy_key.png" /></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Argo CD will only use this key to clone the repository. Allowing write
access is not required.</p>
</div>
<p>Now test the key:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Shell</label><label for="__tabbed_3_2">PowerShell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>$<span class="w"> </span>ssh<span class="w"> </span>-i<span class="w"> </span>./autocloud<span class="w"> </span>git@github.com
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>PTY<span class="w"> </span>allocation<span class="w"> </span>request<span class="w"> </span>failed<span class="w"> </span>on<span class="w"> </span>channel<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>Hi<span class="w"> </span>klasmik/klasmikloud!<span class="w"> </span>You<span class="err">&#39;</span>ve<span class="w"> </span>successfully<span class="w"> </span>authenticated,<span class="w"> </span>but<span class="w"> </span>GitHub<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>provide<span class="w"> </span>shell<span class="w"> </span>access.
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>Connection<span class="w"> </span>to<span class="w"> </span>github.com<span class="w"> </span>closed.
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>$
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="n">ssh</span> <span class="n">-i</span> <span class="n">autocloud</span> <span class="n">git</span><span class="nv">@github</span><span class="p">.</span><span class="n">com</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">PTY</span> <span class="n">allocation</span> <span class="n">request</span> <span class="n">failed</span> <span class="n">on</span> <span class="n">channel</span> <span class="n">0</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="n">Hi</span> <span class="n">klasmik</span><span class="p">/</span><span class="n">klasmikloud</span><span class="p">!</span> <span class="n">You</span><span class="err">&#39;</span><span class="n">ve</span> <span class="n">successfully</span> <span class="n">authenticated</span><span class="p">,</span> <span class="n">but</span> <span class="n">GitHub</span> <span class="n">does</span> <span class="n">not</span> <span class="n">provide</span> <span class="n">shell</span> <span class="n">access</span><span class="p">.</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="n">Connection</span> <span class="n">to</span> <span class="n">github</span><span class="p">.</span><span class="n">com</span> <span class="n">closed</span><span class="p">.</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="n">PS</span><span class="p">&gt;</span>
</code></pre></div>
</div>
</div>
</div>
<p>Now save the private key in the <code>secrets/secrets.dec.yaml</code> in the
<code>github.ssh_key</code> key:</p>
<!-- prettier-ignore-start -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="c1"># ...</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="nt">github</span><span class="p">:</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">        </span><span class="c1"># ...</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">        </span><span class="nt">ssh_key</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">            </span><span class="no">-----BEGIN OPENSSH PRIVATE KEY-----</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">            </span><span class="no">b3BlbnNza...</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">            </span><span class="no">... SpbRCCLhgXt42GirPwlUAAAACWF1dG9jbG91ZAECAwQ= </span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">            </span><span class="no">-----END OPENSSH PRIVATE KEY-----</span>
</code></pre></div>
<!-- prettier-ignore-end -->

<h3 id="argo-cd-authentication">Argo CD Authentication<a class="headerlink" href="#argo-cd-authentication" title="Permanent link">&para;</a></h3>
<p>The Argo CD Autocloud installation comes with a local admin user and with Dex to
allow SSO from an exiting OIDC source. In its initial configuration the SSO is
done through github with all users of the specified organization as admins.</p>
<h4 id="local-admin-password">Local admin password<a class="headerlink" href="#local-admin-password" title="Permanent link">&para;</a></h4>
<p>Choose an admin password (hard to guess, easy to remember) and put it in the
<code>secrets/secrets.dec.yaml</code> file under the <code>data.argocd.admin_password</code> key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># secrets/secrets.dec.yaml</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="c1"># ...</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="nt">argocd</span><span class="p">:</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">        </span><span class="nt">admin_password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</code></pre></div>
<h4 id="github-oidc-authentication">Github OIDC authentication<a class="headerlink" href="#github-oidc-authentication" title="Permanent link">&para;</a></h4>
<div class="admonition info">
<p class="admonition-title">Optional</p>
<p>This is only needed if your want to authenticate to Argo CD with a github
account.</p>
</div>
<p>More details are available in the <a href="https://docs.github.com/en/developers/apps/building-oauth-apps/creating-an-oauth-app" rel="noopener" target="_blank">GitHub documentation about OAuth
Apps</a>.</p>
<p>Go to
<code>https://github.com/organizations/&lt;organization&gt;/settings/applications/new</code> and
create the OAuth application according to the following:</p>
<p><img alt="OAuth application creation" src="../../img/github_oauth_application.png" /></p>
<p>Use the prefix (here <code>argocd-devenv</code>) that you plan to use for the Argo CD Web
UI and the domain name (here <code>klasmik.com</code>) that you plan to use for the access
to the cluster through the cloud.</p>
<p>Once the application is created, copy the Client ID in the
<code>data.github.clientID</code> of the properties.yaml file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="c1"># ...</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="nt">github</span><span class="p">:</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">        </span><span class="c1"># ...</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">        </span><span class="nt">clientID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">f3f29986cc0c4608ce03</span>
</code></pre></div>
<p>Click on the <code>Generate a new client secret</code>.</p>
<p><img alt="OAuth client ID and secret" src="../../img/oauth_client_secret.png" /></p>
<p>Copy the value in the <code>secrets/secrets.dec.yaml</code> file under the
<code>data.github.oauth_client_secret</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="c1"># ...</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="nt">github</span><span class="p">:</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">        </span><span class="c1"># ...</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">        </span><span class="nt">oidc_client_secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">d84...</span>
</code></pre></div>
<p>Autocloud configures Argo CD to let in users pertaining to a particular
organization. You need to specify the organization name in the <code>values.yaml</code>
file under the <code>github</code> key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="c1"># ...</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="nt">github</span><span class="p">:</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">        </span><span class="nt">organization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">klasmik</span>
</code></pre></div>
<h3 id="argo-cd-webhook-update">Argo CD Webhook update<a class="headerlink" href="#argo-cd-webhook-update" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Optional</p>
<p>This is if you want <em>near realtime</em> deployment and if Argo CD
is accessible through internet.</p>
</div>
<p>Argo CD checks the git repositories every 3 minutes for updates. To trigger the
updates as soon as the modifications are pushed, it is convenient to add a
webhook to the repository. The webhook will notify Argo CD to trigger the
modification check immediately.</p>
<p>Create a webhook according to the <a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/webhook/" rel="noopener" target="_blank">Argo CD webhook documentation</a>. Go to</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># In our case, https://github.com/klasmik/klasmikloud/settings/hooks</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>https://github.com/&lt;organization&gt;/&lt;epo&gt;/settings/hooks
</code></pre></div>
<p>Click on the <code>Add webhook</code> button on the top right:</p>
<p><img alt="GitHub Create webhook" src="../../img/github_create_webhook.png" /></p>
<p>Enter a secret. The same secret needs to be inserted in the
<code>secrets/secrets.dec.yaml</code> file in the <code>data.github.webhook_secret</code> key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="c1"># ...</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="nt">github</span><span class="p">:</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">        </span><span class="c1"># ...</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">        </span><span class="nt">webhook_secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3Ab...</span>
</code></pre></div>
<h3 id="dns-provider-api-credentials">DNS provider API credentials<a class="headerlink" href="#dns-provider-api-credentials" title="Permanent link">&para;</a></h3>
<p>Autocloud currently supports two DNS providers: OVH and Cloudflare. Each of them
is configured in its respective <code>ovh</code> and <code>cloudflare</code> sections.</p>
<p>In <code>values.yaml</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># values.yaml</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">    </span><span class="nt">cloudflare</span><span class="p">:</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">        </span><span class="nt">email</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">john@doe.me</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">        </span><span class="nt">dnsZone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">klasmik.com</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">    </span><span class="nt">ovh</span><span class="p">:</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">        </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ovh-eu</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">        </span><span class="nt">applicationKey</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">iYrnuWulPIzRIYZP</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">        </span><span class="nt">dnsZone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">develop.cx</span>
</code></pre></div>
<p>In <code>secrets.yaml</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">    </span><span class="nt">cloudflare</span><span class="p">:</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">        </span><span class="nt">apiKey</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">e...</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">    </span><span class="nt">ovh</span><span class="p">:</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">        </span><span class="nt">application_secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">E...</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">        </span><span class="nt">consumer_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">l...</span>
</code></pre></div>
<p>For OVH, the API access credentials can be created at the following address:
<a href="https://www.ovh.com/auth/api/createToken" rel="noopener" target="_blank">https://www.ovh.com/auth/api/createToken</a></p>
<p>For Cloudflare, you need to retrieve your API token at the following page:
<a href="https://dash.cloudflare.com/profile/api-tokens" rel="noopener" target="_blank">https://dash.cloudflare.com/profile/api-tokens</a></p>
<h3 id="online-presence">Online presence<a class="headerlink" href="#online-presence" title="Permanent link">&para;</a></h3>
<h4 id="cloudflare-tunnel">Cloudflare tunnel<a class="headerlink" href="#cloudflare-tunnel" title="Permanent link">&para;</a></h4>
<p>To setup the cloudflare tunnel, the best option is from the command line with
the help of the <code>cloudflared</code> CLI. To install it, follow the instructions in the
<a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/tunnel-guide/local/#1-download-and-install-cloudflared" rel="noopener" target="_blank">cloudflared documentation</a></p>
<p>Start with login:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="go">&gt; cloudflared tunnel login</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="go">Please open the following URL and log in with your Cloudflare account:</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="gp">https://dash.cloudflare.com/argotunnel?callback=https%3A%2F%2Flogin.cloudflareaccess.org%2F_P_LYLgTz4vuQtxb_BpRhZ3-0KipIrOlyZoX8XxhyFQ%</span>3D
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="go">Leave cloudflared running to download the cert automatically.</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="go">2023-02-09T18:27:21Z INF Waiting for login...</span>
</code></pre></div>
<p>Choose you domain name and validate it:</p>
<p><img alt="cloudflare tunnel login" src="../../img/cloudflare_tunnel_login.png" /></p>
<p>the login ends in the terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="go">...</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="go">2023-02-09T18:27:21Z INF Waiting for login...</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="go">You have successfully logged in.</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="go">If you wish to copy your credentials to a server, they have been saved to:</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="go">/root/.cloudflared/cert.pem</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="go">&gt;</span>
</code></pre></div>
<p>Then create the tunnel:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="go">&gt; cloudflared tunnel create klasmikloud</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="go">Tunnel credentials written to /root/.cloudflared/b3d4c50f-94a7-4d2d-a5a2-b16dbdad6db6.json. cloudflared chose this file based on where your origin certificate was found. Keep this file secret. To revoke these credentials, delete the tunnel.</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="go">Created tunnel klasmikloud with id b3d4c50f-94a7-4d2d-a5a2-b16dbdad6db</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="go">&gt;</span>
</code></pre></div>
<p>The id printed goes in the <code>data.cloudflare.tunnel_id</code> property of the
<code>values.yaml</code> file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># values.yaml</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="c1"># ...</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">    </span><span class="nt">cloudflare</span><span class="p">:</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">        </span><span class="nt">email</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">antoine@openance.com</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">        </span><span class="nt">dnsZone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">klasmik.com</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">        </span><span class="nt">hostName</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;*.klasmik.com&#39;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">        </span><span class="nt">tunnel_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">b3d4c50f-94a7-4d2d-a5a2-b16dbdad6db</span>
</code></pre></div>
<p>The contents of the json file mentioned in the command output (here
<code>/root/.cloudflared/b3d4c50f-94a7-4d2d-a5a2-b16dbdad6db6.json</code>) go in the
<code>secrets/secrets.yaml</code> file in the <code>data.cloudflare.credentials\.json</code> property:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># secrets/secrets.dec.yaml</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">    </span><span class="nt">cloudflare</span><span class="p">:</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">        </span><span class="nt">credentials.json</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">            </span><span class="no">{&quot;AccountTag&quot;:&quot;a...&quot;,&quot;TunnelSecret&quot;:&quot;p...&quot;,&quot;TunnelID&quot;:&quot;b3d4c50f-94a7-4d2d-a5a2-b16dbdad6db6&quot;}</span>
</code></pre></div>
<p>you also need to associate your domain name with the tunnel with the following
command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="go">&gt; cloudflared tunnel route dns klasmikloud argocd-devenv.klasmik.com</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="go">2023-02-09T19:00:16Z INF Added CNAME argocd-devenv.klasmik.com which will route to this tunnel tunnelID=b3d4c50f-94a7-4d2d-a5a2-b16dbdad6db6</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="go">&gt;</span>
</code></pre></div>
<p>If you go to the DNS configuration of your domain name, you will see the <code>CNAME</code>
record:</p>
<p><img alt="tunnel CNAME record" src="../../img/cloudflare_dns_cname.png" /></p>
<div class="admonition note">
<p class="admonition-title">TLS termination</p>
<p>With this configuration, and in particular the fact that the CNAME is
<em>proxied</em>, the TLS termination of the domain name is handled by cloudflare.</p>
</div>
<h4 id="sish">Sish<a class="headerlink" href="#sish" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/antoniomika/sish" rel="noopener" target="_blank">sish</a> enables online presence for the cluster by using the ssh protocol. Sish
offers several advantages:</p>
<ul>
<li>The client is a standard ssh client.</li>
<li>The server supports SNI. You can have multiple subdomains and domain names
    on the same server.</li>
<li>As authentication is done through ssh keys, you can leverage existing
    infrastructure. For instance you can use the github keys API to feed your
    server with authorized keys.</li>
</ul>
<p>There is more information in the <a href="../../components/sish/">sish component page</a>.</p>
<p>For the configuration, you will need the following values:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nt">sish</span><span class="p">:</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">develop.cx</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="nt">remote</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">argocd-devenv.develop.cx</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">    </span><span class="c1"># This is the public key of the private ed25519 key in ../secrets/helm/sish.yaml</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span><span class="nt">host_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AAAAC3NzaC1lZDI1NTE5AAAAIEAfLUpTj0fn5sJFW6agmLMsvEacMBvXocyzHLW+AOSQ</span>
</code></pre></div>
<p><code>hostname</code> is the address of the sish server. <code>remote</code> is the full domain name
that needs to be redirected locally. <code>host_key</code> is the public key of the host.</p>
<p>The only secret is the ssh private key to connect to the server:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nt">sish</span><span class="p">:</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">    </span><span class="nt">ssh_key</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">        </span><span class="no">-----BEGIN OPENSSH PRIVATE KEY-----</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">        </span><span class="no">b3B...</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">        </span><span class="no">...FBg==</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">        </span><span class="no">-----END OPENSSH PRIVATE KEY-----</span>
</code></pre></div>
<p>This key needs to be registered in a github account so that the URL
<code>https://github.com/&lt;account&gt;.keys</code> returns the public key. The name of the
github account needs to be passed to the deployment of the <code>sish</code> helm chart in
the <code>auth.github_accounts</code> key.</p>
<h3 id="other-properties">Other properties<a class="headerlink" href="#other-properties" title="Permanent link">&para;</a></h3>
<p>At this point the other properties of the <code>values.yaml</code> files (<code>sish</code>...) can be
left as is.</p>
<h2 id="committing-current-configuration">Committing current configuration<a class="headerlink" href="#committing-current-configuration" title="Permanent link">&para;</a></h2>
<p>At this point you should commit the current configuration without forgetting to
encrypt the secrets.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Shell</label><label for="__tabbed_4_2">PowerShell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>$<span class="w"> </span>sops<span class="w"> </span>-e<span class="w"> </span>secrets/secrets.dec.yaml<span class="w"> </span>&gt;<span class="w"> </span>secrets/secrets.yaml
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>$<span class="w"> </span>rm<span class="w"> </span>secrets/secrets.dec.yaml
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>$<span class="w"> </span>git<span class="w"> </span>add<span class="w"> </span>values.yaml<span class="w"> </span>secrets/secrets.yaml
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;🔧 Platform values and secrets customization&quot;</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>$
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="n">sops</span> <span class="n">-e</span> <span class="n">secrets</span><span class="p">\</span><span class="n">secrets</span><span class="p">.</span><span class="n">dec</span><span class="p">.</span><span class="n">yaml</span> <span class="p">&gt;</span> <span class="n">secrets</span><span class="p">\</span><span class="n">secrets</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="nb">Remove-Item</span> <span class="n">secrets</span><span class="p">/</span><span class="n">secrets</span><span class="p">.</span><span class="n">dec</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="n">git</span> <span class="n">add</span> <span class="n">values</span><span class="p">.</span><span class="n">yaml</span> <span class="n">secrets</span><span class="p">\</span><span class="n">secrets</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="n">git</span> <span class="n">commit</span> <span class="n">-m</span> <span class="s2">&quot;🔧 Platform values and secrets customization&quot;</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="n">PS</span><span class="p">&gt;</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="applying-properties-to-kustomizations-and-applications">Applying properties to kustomizations and applications<a class="headerlink" href="#applying-properties-to-kustomizations-and-applications" title="Permanent link">&para;</a></h2>
<p>Apply the values to the current environment:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Shell</label><label for="__tabbed_5_2">PowerShell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>$<span class="w"> </span>kustomize<span class="w"> </span>fn<span class="w"> </span>run<span class="w"> </span>--enable-exec<span class="w"> </span>packages
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>$<span class="w"> </span>kustomize<span class="w"> </span>fn<span class="w"> </span>run<span class="w"> </span>--enable-exec<span class="w"> </span>apps
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>$<span class="w"> </span>git<span class="w"> </span>status
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>On<span class="w"> </span>branch<span class="w"> </span>deploy/devenv
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>Changes<span class="w"> </span>not<span class="w"> </span>staged<span class="w"> </span><span class="k">for</span><span class="w"> </span>commit:
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="o">(</span>use<span class="w"> </span><span class="s2">&quot;git add &lt;file&gt;...&quot;</span><span class="w"> </span>to<span class="w"> </span>update<span class="w"> </span>what<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>committed<span class="o">)</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="o">(</span>use<span class="w"> </span><span class="s2">&quot;git restore &lt;file&gt;...&quot;</span><span class="w"> </span>to<span class="w"> </span>discard<span class="w"> </span>changes<span class="w"> </span><span class="k">in</span><span class="w"> </span>working<span class="w"> </span>directory<span class="o">)</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">        </span>modified:<span class="w">   </span>apps/available/apisix.yaml
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">        </span>modified:<span class="w">   </span>apps/available/applications-set.yaml
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">        </span>modified:<span class="w">   </span>apps/available/argocd.yaml
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">        </span>modified:<span class="w">   </span>apps/available/bootstrap.yaml
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">        </span>modified:<span class="w">   </span>apps/available/cert-manager.yaml
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">        </span>modified:<span class="w">   </span>apps/available/chisel-client.yaml
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">        </span>modified:<span class="w">   </span>apps/available/external-dns-cloudflare.yaml
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">        </span>modified:<span class="w">   </span>apps/available/external-dns-ovh.yaml
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">        </span>modified:<span class="w">   </span>apps/available/ingresses.yaml
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">        </span>modified:<span class="w">   </span>apps/available/sish.yaml
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">        </span>modified:<span class="w">   </span>packages/argocd/argocd-cm.yaml
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">        </span>modified:<span class="w">   </span>packages/argocd/autocloud-cm.yaml
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="w">        </span>modified:<span class="w">   </span>packages/cert-manager/letsencrypt-issuer.yaml
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">        </span>modified:<span class="w">   </span>packages/cloudflare-client/deployment.yaml
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="w">        </span>modified:<span class="w">   </span>packages/external-dns-cloudflare/external-dns-configmap.yaml
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="w">        </span>modified:<span class="w">   </span>packages/external-dns-cloudflare/external-dns-secret.yaml
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a><span class="w">        </span>modified:<span class="w">   </span>packages/external-dns-ovh/external-dns-configmap.yaml
<a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a><span class="w">        </span>modified:<span class="w">   </span>packages/external-dns-ovh/external-dns-secret.yaml
<a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a><span class="w">        </span>modified:<span class="w">   </span>packages/ingresses/argocd-ingress-cloudflare.yaml
<a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a><span class="w">        </span>modified:<span class="w">   </span>packages/ingresses/argocd-ingress.yaml
<a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a><span class="w">        </span>modified:<span class="w">   </span>packages/sish-client/sish-client.yaml
<a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a>
<a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a>no<span class="w"> </span>changes<span class="w"> </span>added<span class="w"> </span>to<span class="w"> </span>commit<span class="w"> </span><span class="o">(</span>use<span class="w"> </span><span class="s2">&quot;git add&quot;</span><span class="w"> </span>and/or<span class="w"> </span><span class="s2">&quot;git commit -a&quot;</span>
<a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a>$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-a<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;🔧 Applied platform values to applications and packages&quot;</span>
<a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a>$
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="n">kustomize</span> <span class="n">fn</span> <span class="n">run</span> <span class="p">-</span><span class="n">-enable-exec</span> <span class="n">packages</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="n">kustomize</span> <span class="n">fn</span> <span class="n">run</span> <span class="p">-</span><span class="n">-enable-exec</span> <span class="n">apps</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="n">git</span> <span class="n">status</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="n">On</span> <span class="n">branch</span> <span class="n">deploy</span><span class="p">/</span><span class="n">devenv</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="n">Changes</span> <span class="n">not</span> <span class="n">staged</span> <span class="k">for</span> <span class="n">commit</span><span class="p">:</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="p">(</span><span class="n">use</span> <span class="s2">&quot;git add &lt;file&gt;...&quot;</span> <span class="n">to</span> <span class="n">update</span> <span class="n">what</span> <span class="n">will</span> <span class="n">be</span> <span class="n">committed</span><span class="p">)</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="p">(</span><span class="n">use</span> <span class="s2">&quot;git restore &lt;file&gt;...&quot;</span> <span class="n">to</span> <span class="n">discard</span> <span class="n">changes</span> <span class="k">in</span> <span class="n">working</span> <span class="n">directory</span><span class="p">)</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">apps</span><span class="p">/</span><span class="n">available</span><span class="p">/</span><span class="n">apisix</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">apps</span><span class="p">/</span><span class="n">available</span><span class="p">/</span><span class="n">applications-set</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">apps</span><span class="p">/</span><span class="n">available</span><span class="p">/</span><span class="n">argocd</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">apps</span><span class="p">/</span><span class="n">available</span><span class="p">/</span><span class="n">bootstrap</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">apps</span><span class="p">/</span><span class="n">available</span><span class="p">/</span><span class="n">cert-manager</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">apps</span><span class="p">/</span><span class="n">available</span><span class="p">/</span><span class="n">chisel-client</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">apps</span><span class="p">/</span><span class="n">available</span><span class="p">/</span><span class="n">external-dns-cloudflare</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">apps</span><span class="p">/</span><span class="n">available</span><span class="p">/</span><span class="n">external-dns-ovh</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">apps</span><span class="p">/</span><span class="n">available</span><span class="p">/</span><span class="n">ingresses</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">apps</span><span class="p">/</span><span class="n">available</span><span class="p">/</span><span class="n">sish</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">packages</span><span class="p">/</span><span class="n">argocd</span><span class="p">/</span><span class="n">argocd-cm</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">packages</span><span class="p">/</span><span class="n">argocd</span><span class="p">/</span><span class="n">autocloud-cm</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">packages</span><span class="p">/</span><span class="n">cert-manager</span><span class="p">/</span><span class="n">letsencrypt-issuer</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">packages</span><span class="p">/</span><span class="n">cloudflare-client</span><span class="p">/</span><span class="n">deployment</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">packages</span><span class="p">/</span><span class="n">external-dns-cloudflare</span><span class="p">/</span><span class="n">external-dns-configmap</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">packages</span><span class="p">/</span><span class="n">external-dns-cloudflare</span><span class="p">/</span><span class="n">external-dns-secret</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">packages</span><span class="p">/</span><span class="n">external-dns-ovh</span><span class="p">/</span><span class="n">external-dns-configmap</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">packages</span><span class="p">/</span><span class="n">external-dns-ovh</span><span class="p">/</span><span class="n">external-dns-secret</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">packages</span><span class="p">/</span><span class="n">ingresses</span><span class="p">/</span><span class="n">argocd-ingress-cloudflare</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">packages</span><span class="p">/</span><span class="n">ingresses</span><span class="p">/</span><span class="n">argocd-ingress</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a>        <span class="n">modified</span><span class="p">:</span>   <span class="n">packages</span><span class="p">/</span><span class="n">sish-client</span><span class="p">/</span><span class="n">sish-client</span><span class="p">.</span><span class="n">yaml</span>
<a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a>
<a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a><span class="n">no</span> <span class="n">changes</span> <span class="n">added</span> <span class="n">to</span> <span class="n">commit</span> <span class="p">(</span><span class="n">use</span> <span class="s2">&quot;git add&quot;</span> <span class="n">and</span><span class="p">/</span><span class="n">or</span> <span class="s2">&quot;git commit -a&quot;</span>
<a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="n">git</span> <span class="n">commit</span> <span class="n">-a</span> <span class="n">-m</span> <span class="s2">&quot;🔧 Applied platform values to applications and packages&quot;</span>
<a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a><span class="n">PS</span><span class="p">&gt;</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="selecting-the-applications-to-deploy-at-bootstrap">Selecting the applications to deploy at bootstrap<a class="headerlink" href="#selecting-the-applications-to-deploy-at-bootstrap" title="Permanent link">&para;</a></h2>
<p>To understand how the cluster is bootstrapped, please read the relevant section
in the <a href="../../architecture/#bootstrapping-stages">Architecture page</a>.</p>
<p>What we will do for now is just add or remove the symbolic links to applications
manifests in the <code>apps/bootstrap</code> and <code>apps/default</code> directories to accommodate
our setup.</p>
<p>Taking K3s as an example, it provides out of the box the load balancer, storage
class, metrics and ingress controller. In consequence, we don't need to deploy
<code>uninode</code> nor <code>traefik</code>. We will remove them from bootstrap:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">Shell</label><label for="__tabbed_6_2">PowerShell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>$<span class="w"> </span>rm<span class="w"> </span>apps/bootstrap/<span class="o">{</span>traefik,uninode<span class="o">}</span>.yaml
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>$
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="p">@(</span><span class="s1">&#39;traefik&#39;</span><span class="p">,</span> <span class="s1">&#39;uninode&#39;</span><span class="p">)</span> <span class="p">|</span> <span class="p">%</span> <span class="p">{</span> <span class="nb">remove-item</span> <span class="n">apps</span><span class="p">/</span><span class="n">bootstrap</span><span class="p">/</span><span class="nv">$_</span><span class="p">.</span><span class="n">yaml</span> <span class="p">}</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">PS</span><span class="p">&gt;</span>
</code></pre></div>
</div>
</div>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The advantage of starting from a <em>naked</em> cluster is that the base services
are managed by Argo CD and can be updated with gitops.</p>
</div>
<p>In K3s, traefik is installed in the <code>kube-system</code> namespace while <code>uninode</code>
installs it in the <code>traefik</code> namespace. In consequence, we need to adapt the
domain names of the tunnels redirections:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="gd">--- a/packages/cloudflare-client/deployment.yaml</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="gi">+++ b/packages/cloudflare-client/deployment.yaml</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="gu">@@ -10,7 +10,7 @@ data:</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w"> </span>    credentials-file: /credentials/credentials.json
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w"> </span>    ingress:
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w"> </span>    - hostname: &quot;*.klasmik.com&quot;
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="gd">-      service: http://traefik.traefik.svc:80</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="gi">+      service: http://traefik.kube-system.svc:80</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="w"> </span>    - service: http_status:404
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="w"> </span>---
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="w"> </span>apiVersion: v1
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="gd">--- a/packages/sish-client/sish-client.yaml</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="gi">+++ b/packages/sish-client/sish-client.yaml</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="gu">@@ -37,7 +37,7 @@ data:</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="w"> </span>      ServerAliveInterval 10
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="w"> </span>      ServerAliveCountMax 2
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="w"> </span>      RemoteCommand sni-proxy=true
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="gd">-      RemoteForward argocd-devenv.develop.cx:443 traefik.traefik.svc:443</span>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="gi">+      RemoteForward argocd-devenv.develop.cx:443 traefik.kube-system.svc:443</span>
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a><span class="w"> </span>  known_hosts: |
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a><span class="w"> </span>    [develop.cx]:2222 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAID+3abW2y3T5dodnI5O1Z/2KlIdH3bwnbGDvCFf13zlh
<a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="w"> </span>---
</code></pre></div>
<p>Once you have committed your changes and pushed the branch, proceed to the
<a href="../5-cluster-deployment">Cluster deployment<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></span></a>.</p>
<!-- prettier-ignore-start -->

<!-- prettier-ignore-end -->





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../3-change-encryption-key/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 3. Change the encryption key" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                3. Change the encryption key
              </div>
            </div>
          </a>
        
        
          
          <a href="../5-cluster-deployment/" class="md-footer__link md-footer__link--next" aria-label="Next: 5. Deploy the cluster" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                5. Deploy the cluster
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.action.view", "content.action.edit", "content.code.annotate", "content.code.copy", "content.tabs.link", "content.tooltips", "navigation.top", "navigation.footer", "tabs", "toc.follow"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>